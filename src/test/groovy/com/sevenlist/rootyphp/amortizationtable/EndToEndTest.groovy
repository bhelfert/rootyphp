package com.sevenlist.rootyphp.amortizationtable

import groovy.ui.SystemOutputInterceptor
import spock.lang.Specification

class EndToEndTest extends Specification {

    def "using valid arguments results in a correctly calculated and printed amortization table"() {
        given:
        StringBuilder output = new StringBuilder()
        SystemOutputInterceptor soutInterceptor = new SystemOutputInterceptor({
            output.append(it)
            false
        })

        String[] args = [
                '-la', 200000,
                '-di', 1.43,
                '-ia', 2.5,
                '-fir', 15
        ]

        when:
        soutInterceptor.start()
        AmortizationTableCalculator.main(args)
        soutInterceptor.stop()

        then:
        def outputAsString = output.toString()
        outputAsString.contains("""
Tilgungsplan für
* Darlehensbetrag:     200.000,00 €
* Sollzins:            1,43%
* Anfängliche Tilgung: 2,5%
* Zinsbindung:         15 Jahre

+------------------+---------------+-------------+------------------------------+---------------+
|       Datum      |   Restschuld  |    Zinsen   | Tilgung (+) / Auszahlung (-) |      Rate     |
+------------------+---------------+-------------+------------------------------+---------------+
|       31.08.2015 | -200.000,00 € |      0,00 € |                -200.000,00 € | -200.000,00 € |
|       30.09.2015 | -199.583,33 € |    238,33 € |                     416,67 € |      655,00 € |
|       31.10.2015 | -199.166,17 € |    237,84 € |                     417,16 € |      655,00 € |
|       30.11.2015 | -198.748,51 € |    237,34 € |                     417,66 € |      655,00 € |
|       31.12.2015 | -198.330,35 € |    236,84 € |                     418,16 € |      655,00 € |
|       31.01.2016 | -197.911,70 € |    236,34 € |                     418,66 € |      655,00 € |
|       29.02.2016 | -197.492,54 € |    235,84 € |                     419,16 € |      655,00 € |
|       31.03.2016 | -197.072,89 € |    235,35 € |                     419,65 € |      655,00 € |
|       30.04.2016 | -196.652,73 € |    234,85 € |                     420,15 € |      655,00 € |
|       31.05.2016 | -196.232,08 € |    234,34 € |                     420,66 € |      655,00 € |
|       30.06.2016 | -195.810,92 € |    233,84 € |                     421,16 € |      655,00 € |
|       31.07.2016 | -195.389,26 € |    233,34 € |                     421,66 € |      655,00 € |
|       31.08.2016 | -194.967,10 € |    232,84 € |                     422,16 € |      655,00 € |
|       30.09.2016 | -194.544,43 € |    232,34 € |                     422,66 € |      655,00 € |
|       31.10.2016 | -194.121,27 € |    231,83 € |                     423,17 € |      655,00 € |
|       30.11.2016 | -193.697,59 € |    231,33 € |                     423,67 € |      655,00 € |
|       31.12.2016 | -193.273,42 € |    230,82 € |                     424,18 € |      655,00 € |
|             2017 | -188.143,69 € |  2.730,28 € |                   5.129,72 € |    7.860,00 € |
|             2018 | -182.940,13 € |  2.656,44 € |                   5.203,56 € |    7.860,00 € |
|             2019 | -177.661,67 € |  2.581,54 € |                   5.278,46 € |    7.860,00 € |
|             2020 | -172.307,23 € |  2.505,56 € |                   5.354,44 € |    7.860,00 € |
|             2021 | -166.875,71 € |  2.428,49 € |                   5.431,51 € |    7.860,00 € |
|             2022 | -161.366,02 € |  2.350,30 € |                   5.509,70 € |    7.860,00 € |
|             2023 | -155.777,01 € |  2.271,00 € |                   5.589,00 € |    7.860,00 € |
|             2024 | -150.107,56 € |  2.190,55 € |                   5.669,45 € |    7.860,00 € |
|             2025 | -144.356,51 € |  2.108,94 € |                   5.751,06 € |    7.860,00 € |
|             2026 | -138.522,67 € |  2.026,16 € |                   5.833,84 € |    7.860,00 € |
|             2027 | -132.604,85 € |  1.942,19 € |                   5.917,81 € |    7.860,00 € |
|             2028 | -126.601,86 € |  1.857,01 € |                   6.002,99 € |    7.860,00 € |
|             2029 | -120.512,46 € |  1.770,60 € |                   6.089,40 € |    7.860,00 € |
|       31.01.2030 | -120.001,07 € |    143,61 € |                     511,39 € |      655,00 € |
|       28.02.2030 | -119.489,07 € |    143,00 € |                     512,00 € |      655,00 € |
|       31.03.2030 | -118.976,46 € |    142,39 € |                     512,61 € |      655,00 € |
|       30.04.2030 | -118.463,24 € |    141,78 € |                     513,22 € |      655,00 € |
|       31.05.2030 | -117.949,41 € |    141,17 € |                     513,83 € |      655,00 € |
|       30.06.2030 | -117.434,97 € |    140,56 € |                     514,44 € |      655,00 € |
|       31.07.2030 | -116.919,91 € |    139,94 € |                     515,06 € |      655,00 € |
|       31.08.2030 | -116.404,24 € |    139,33 € |                     515,67 € |      655,00 € |
| Zinsbindungsende | -116.404,24 € | 34.304,24 € |                  83.595,76 € |  117.900,00 € |
+------------------+---------------+-------------+------------------------------+---------------+
""")
        println outputAsString
    }
}
